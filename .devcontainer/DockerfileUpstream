FROM haskell:8.10

ARG WDIR=/opt/Ampersand

WORKDIR ${WDIR}

RUN stack update 

# Add just the .cabal file to capture dependencies
COPY ./package.yaml ${WDIR}/package.yaml
COPY ./stack.yaml ${WDIR}/stack.yaml

# Docker will cache this command as a layer, freeing us up to
# modify source code without re-installing dependencies
# (unless one of the copied files changes!)
RUN stack build --only-dependencies -j4

# Add and Install Application Code
COPY . ${WDIR}
RUN stack install

ENV DEBIAN_FRONTEND=dialog

ENTRYPOINT ["/bin/bash"]