FROM ubuntu:focal
## Inspiration from https://stackoverflow.com/questions/67680726/installing-haskells-cabal-or-ghcup-inside-a-dockerfile-wont-work
ARG DEBIAN_FRONTEND=noninteractive
ENV TZ=Europe/Berlin

# install dependencies
RUN \
    apt-get update -y && \
    apt-get install -y --no-install-recommends \
    curl \
    libnuma-dev \
    zlib1g-dev \
    libgmp-dev \
    libgmp10 \
    git \
    wget \
    lsb-release \
    software-properties-common \
    gnupg2 \
    apt-transport-https \
    gcc \
    autoconf \
    automake \
    build-essential

# install gpg keys
ARG GPG_KEY=BA3CBA3FFE22B574
RUN gpg --batch --keyserver keys.openpgp.org --recv-keys $GPG_KEY

# install ghcup
RUN \
    curl https://downloads.haskell.org/~ghcup/x86_64-linux-ghcup > /usr/bin/ghcup && \
    chmod +x /usr/bin/ghcup && \
    ghcup config set gpg-setting GPGLax


ARG GHC=8.10.7
ARG CABAL=3.10.1.0
ARG HLS=2.0.0.1
ARG STACK=2.11.1

# install GHC and cabal

RUN ghcup -v install ghc --isolate /usr/local --force ${GHC}
RUN ghcup -v install cabal --isolate /usr/local/bin --force ${CABAL}
RUN ghcup -v install stack --isolate /usr/local/bin --force ${STACK}
RUN ghcup -v install hls --isolate /usr/local/bin --force ${HLS}

ENV DEBIAN_FRONTEND=dialog

ENTRYPOINT ["/bin/bash"]